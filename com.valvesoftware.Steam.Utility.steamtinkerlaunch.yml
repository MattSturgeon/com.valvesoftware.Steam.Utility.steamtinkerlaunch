id: com.valvesoftware.Steam.Utility.steamtinkerlaunch
default-branch: test
sdk: org.freedesktop.Sdk//21.08
runtime: com.valvesoftware.Steam
runtime-version: test
build-extension: true
appstream-compose: false
separate-locales: false
rename-icon: steamtinkerlaunch
rename-desktop-file: steamtinkerlaunch.desktop

build-options:
  prefix: /app/utils/steamtinkerlaunch
  prepend-path: /app/utils/steamtinkerlaunch/bin
  append-pkg-config-path: /app/utils/steamtinkerlaunch/lib/pkgconfig
  strip: true

cleanup:
  - /include
  - /lib/*.a
  - /lib/*.la
  - /share/doc
  - /share/man

modules:
  - name: git
    make-args:
      - INSTALL_SYMLINKS=1
      - NO_PERL=YesPlease
      - NO_TCLTK=YesPlease
    make-install-args:
      - INSTALL_SYMLINKS=1
      - NO_PERL=YesPlease
      - NO_TCLTK=YesPlease
    sources:
      - type: archive
        url: https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.36.0.tar.xz
        sha256: af5ebfc1658464f5d0d45a2bfd884c935fb607a10cc021d95bc80778861cc1d3

  - name: jq
    config-opts:
      - "--disable-maintainer-mode"
      - "--with-oniguruma=builtin"
    sources:
      - type: git
        url: https://github.com/stedolan/jq
        tag: jq-1.6
        commit: 2e01ff1fb69609540b2bdc4e62a60499f2b2fb8e
      - type: "script"
        commands: [ "autoreconf -fi" ]
        dest-filename: "autogen.sh"

  - name: xdotool
    no-autogen: true
    make-args:
      - WITHOUT_RPATH_FIX=1
    make-install-args:
      - 'PREFIX=${FLATPAK_DEST}'
      - 'INSTALLMAN=${FLATPAK_DEST}/share/man'
    sources:
      - type: archive
        url: https://github.com/jordansissel/xdotool/archive/v3.20211022.1/xdotool-3.20211022.1.tar.gz
        sha256: 82b15a944a5e82fee15e0f6116bd9f642bc3d0bb6989fc0ca5ad9dfe35de0847
        x-checker-data:
          type: anitya
          project-id: 8648
          stable-only: true
          url-template: https://github.com/jordansissel/xdotool/archive/v$version/xdotool-$version.tar.gz
    cleanup:
      - /share/man

  - name: xprop
    sources:
      - type: archive
        url: https://xorg.freedesktop.org/archive/individual/app/xprop-1.2.5.tar.gz
        sha256: b7bf6b6be6cf23e7966a153fc84d5901c14f01ee952fbd9d930aa48e2385d670

  - name: xwininfo
    sources:
      - type: archive
        url: https://xorg.freedesktop.org/archive/individual/app/xwininfo-1.1.5.tar.bz2
        sha256: 7a405441dfc476666c744f5fcd1bc8a75abf8b5b1d85db7b88b370982365080e

  - name: xxd
    buildsystem: simple
    build-commands:
        - make -C src/xxd
        - install -Dm755 -t "${FLATPAK_DEST}/bin" src/xxd/xxd
    sources:
      - type: archive
        url: https://github.com/vim/vim/archive/v8.2.4959/vim-v8.2.4959.tar.gz
        sha256: 7fe9a666c252d3f5fb635a752d15758a4e7df836985ec214be549cb326474296

  - name: yad
    config-opts:
      - "--enable-standalone"
    sources:
      - type: archive
        url: https://github.com/v1cont/yad/releases/download/v12.0/yad-12.0.tar.xz
        sha256: 65dbfa72a229f6cbd131470caf4f70fec98fe935a1436acb58c841fa2a8bddde
    modules:
      - name: intltool
        cleanup:
          - "*"
        sources:
          - type: archive
            url: "https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz"
            sha256: 67c74d94196b153b774ab9f89b2fa6c6ba79352407037c8c14d5aeb334e959cd

  - name: steamtinkerlaunch
    build-options:
      env:
        PREFIX: /app/utils/steamtinkerlaunch
    buildsystem: simple
    build-commands:
      - make install
      - install -Dm644 -t ${FLATPAK_DEST}/share/steam/compatibilitytools.d SteamTinkerLaunch.vdf
      - install -Dm644 -t ${FLATPAK_DEST}/bin toolmanifest.vdf
    sources:
      - type: git
        url: https://github.com/frostworx/steamtinkerlaunch/
        commit: d16b76c45fe77f0b64b19b041be08becd1ae45ee #v10.0.20220601
      #- type: archive
      #  url: https://github.com/frostworx/steamtinkerlaunch/archive/v10.0.tar.gz
      #  sha256: 9337bf239a00c7fe1ccc53b33311391f8bb47b1865d8bbff8b964ade557537b4
      - type: file
        path: SteamTinkerLaunch.vdf
      - type: file
        path: toolmanifest.vdf

  - name: metadata
    buildsystem: simple
    build-commands:
      - install -Dm644 -t ${FLATPAK_DEST}/share/metainfo ${FLATPAK_ID}.metainfo.xml
      - appstream-compose --basename=${FLATPAK_ID} --prefix=${FLATPAK_DEST} --origin=flatpak ${FLATPAK_ID}
    sources:
      - type: file
        path: com.valvesoftware.Steam.Utility.steamtinkerlaunch.metainfo.xml
